---
title: "Projet ADM Q2"
author: "RODRIGUES Camille-Astrid AMOUROUX Jan"
date: "`r Sys.Date()`"
editor_options:
  chunk_output_type: console
---

```{r include=FALSE}
knitr::opts_chunk$set(fig.align="center", fig.width=6, fig.height=6, fig.path="Figs/", echo=TRUE, warning=FALSE, message=FALSE, cache=TRUE)
```

```{r, include= F}
library(tidyverse)
library(ade4)

#library(rpart)

#library(MASS)
```

======================= QUESTION 2 =======================

--> espèces : caractéristiques

--> habitat : caractéristiques

    ==> impact de l'habitat sur les caractéristiques de l'espèce

--> petit ou grand selon la température, etc …

Ouverture des données : 

```{r}
habitat = read.table("../data/habitat.tsv", sep = "\t",
                     stringsAsFactors = T, header = T, na.strings = T)
especes = read.table("../data/especes.tsv", sep = "\t",
                     stringsAsFactors = T, header = T, na.strings = T)
commu = read.table("../data/communautes.tsv", sep = "\t", stringsAsFactors = T, header = T, na.strings = T)

habitat = habitat[,-2:-3]
habitat[,2:3] = habitat[,2:3]/1e5 ;# habitat[15] = habitat[15]/1e3
name = colnames(habitat)
name[2:3] = c("long/1e5","lat/1e5");# name[15] = "prec/1e3"
colnames(habitat) = name
```

ANALYSE :

####  ==> extraire informations précédentes = subset par colonnes dont on extrait les numéros des localisations

Création des subsets de numéro de lieu ayant des Gem (Colombe.a.croissants)
```{r}
vectNom = names(commu[2:17])

listSubsets = data.frame(matrix(nrow = length(vectNom), ncol = length(habitat[1,]) - 3))

for (i in 1:length(vectNom)) {
  especesActu = vectNom[i]
  foosubset = subset(commu$IdPE, commu[[i+1]] == 1)  
  listSubsets[[especesActu]] <- foosubset
}

listSubsets$Gem
```

On a toutes les localisation de chaque espèce

Exemple d'appel pour les localisation de Gem : 
listSubsets$gem

####  ==> moyenne des données sur l'habitat pour chaque colonne du subset (espèces)

Pour se donner une idée de vers ou on vas, nous allons regarder chaque moyenne de variables 

```{r}
par(mfrow = c(1,1))
ExGem = colMeans(subset(habitat, habitat$IdPE %in% listSubsets$Gem))
plot(ExGem[-1])
```

Généraliser par une boucle tapply : 

```{r}
ExMat <- t(sapply(names(listSubsets), function(name) {
  colMeans(subset(habitat, habitat$IdPE %in% listSubsets[[name]]))
}))
ExMat = ExMat[,-1]
```

/!\\ sapply == tapply mais pour sortir une matrice et pas une liste /!\\

```{r}
boxplot(ExMat,
     pch = 3, col = "darkred",
     las = 2, log = "y")
labels
```

Des boxplots plus interresant : 

  1. Point d'écoute : 

```{r}
plot(ExMat[,1:2],
     pch = 3, col = "brown")
```

  2. Occupation du sol : 
  
```{r}
boxplot(ExMat[,3:7],
     pch = 3, col = "darkgreen")
```

  3. Fragmentation : 
  
```{r}
boxplot(ExMat[,8:11],
     pch = 3, col = "salmon")
```

  4. Topographie

```{r}
plot(ExMat[,12:13],
     pch = 3, col = "black")
```

  5. condition topographique
  
```{r}
plot(ExMat[,14:15],
     pch = 3, col = "darkblue")
```

  6. Urbanisation
  
```{r}
boxplot(ExMat[,16],
     pch = 3, col = "darkgray")
```
  

####  ==> expliquer chacune des variables de l'espèce en fonction des variables de l'environnement

    --> taille petite quand température haute, alimentation quand hydrométrie élevée

```{r}
dudi.pca()
```



####  ==> juxtaposition des tableaux :
    
    tab1 --> subset = colnames(especes) + moyenne de chaque caractéristique des milieux

transposé de tab1 sur tab2
    
    tab2 --> especes
    ==> expected : certaines caractéristiques du milieu explique certaines caractéristiques de l'espèce

####  ==> conclure :
  










