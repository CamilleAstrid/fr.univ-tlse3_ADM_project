---
title: "Projet ADM Q1"
author: "RODRIGUES Camille-Astrid AMOUROUX Jan"
date: "`r Sys.Date()`"
output: 
  html_document:
    code_folding: hide
    toc: TRUE
    cache: TRUE
editor_options: 
  chunk_output_type: console
---

```{r include=FALSE, eval=FALSE}
knitr::opts_chunk$set(fig.align="center", fig.width=6, fig.height=6, fig.path="Figs/", echo=TRUE, warning=FALSE, message=FALSE, cache=TRUE)
```

```{r, include= F}
library(tidyverse)
library(ade4)
library(vegan)
```

--> communautés : quelles sont les espèces qui vivent ensemble ? même localisation ? exemple : Est-ce que pinson toujours avec pie ?
--> habitat : différentes répartitions selon la localisation ? exemple : Quand il fait chaud, les pinsons ne blairent plus les pies ?

==> impact de l'environnement sur la répartition des espèces
--> interactions ou évitements

ANALYSE :
==> test du Chi² pour vérifier la dépendance entre les données localisations et présence de l'espèce
==> ACM(commu) : nous avons des données utilisant des modalités simples avec j individus et i localisations
==> expected : groupes d'oiseaux, oiseaux "ubiquitaires"
==> test corrélation des variables entre-elles pour diminuer le nombre de variables à étudier
==> ACP(habitat) : lissage des données qualitatives au besoin, réduction du nombre de variables
==> co-inertie = ACM+ACP : couplage de tableaux entre habitat et répartition espèces
==> expected : présence de cluster en fonction de certaines caractéristiques du milieu

==> conclure : comportements différents selon la qualité de vie du milieu (caractéristiques ciblées par l'analyse)


Ouverture des documents :

```{r}
habitat = read.table("../data/habitat.tsv", sep = "\t",
                     stringsAsFactors = T, header = T, na.strings = T)
especes = read.table("../data/especes.tsv", sep = "\t",
                     stringsAsFactors = T, header = T, na.strings = T)
commu = read.table("../data/communautes.tsv", sep = "\t",
                     stringsAsFactors = T, header = T, na.strings = T)
```


Test du X² : indépendance entre présence de l'espèce et caractéristiques du milieux ?

```{r}
res = chisq.test(commu[,2:17]) ; res$

res2 = list()
for (i in 2:17){
  print(chisq.test(commu[,i])$p.value)
  }
```

==> La localisation n'impacte pas la répartition des espèces.

ACP normée sur environnement (habitat)

```{r}
plot(habitat)

res = chisq.test(habitat[,4:19]) ; res
# Dépendance des données

acp_habitat = dudi.pca(habitat[,4:19], scale=T, nf = 2, scannf = F)
plot(acp_habitat$li,
     pch = 3)
s.corcircle(acp_habitat$co,
            grid = F)
acp_habitat$c1
# 1 variable expliquant peu le modèle : hydro (faible pourcentage d'explication des axes, <10%)
```

AFC sur répartition des espèces (commu)

```{r}
plot(commu)

res = chisq.test(commu[,2:17]) ; res
# Indépendance des données

afc1 = dudi.coa(commu, nf=2, scannf = F)
afc1
barplot(afc1$eig)
scatter(afc1)
```

Couplage de tableaux entre AFC (tableau espèce) et une ACP normée (tableau habitat)

```{r}
# Log des données
caract_habitat = habitat[,-(1:3)]
log_habitat = log(caract_habitat +1)

cca = pcaiv(afc1, log_habitat, scannf = F, nf = 2)

#projection axe d'inertie
s.corcircle(cca$as)

# Position des relevés par combinaisons de variables environnementales : représentation des sites
s.label(cca$l1, clabel = 0, cpoint = 1.5)

# Position des espèces à la moyenne des sites qui les contiennent : représentation des espèces
s.label(cca$co, add.plot = T)

# Poids canoniques donnant les combinaisons de variance unité
s.arrow(cca$fa)

# Prédiction des positions par régression sur les variables de milieu
s.match(cca$li, cca$ls, clabel = 0.5)

# Ensemble des résultats de l'analyse
plot(cca)
```

ACC sur les données HABITAT x COMMU

```{r}
acc1 = cca(afc1, acp_habitat)
```









































